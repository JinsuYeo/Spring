# Spring Study

스프링 공부 및 정리

---

## 스프링 MVC

---

### 1. 웹 서버, 웹 애플리케이션 서버

#### 1) 웹 서버

- HTTP 기반으로 동작
- 정적 리소스를 제공(정적 HTML, CSS, JS, 이미지, 영상)
#### 2) 웹 애플리케이션 서버(WAS)

- 웹 서버는 정적 리소스, WAS는 정적 리소스 + 애플리케이션 로직
- 자바는 서블릿 컨테이너 기능을 제공하면 WAS
- ***WAS는 애플리케이션 코드를 실행하는데 더 특화***

#### 3) 웹 시스템 구성

- WAS는 정적 리소스와 애플리케이션 로직 모두 제공 가능 -> WAS, DB만으로 시스템 구성 가능
  - 하지만 WAS가 너무 많은 역할 담당 시 서버 과부하 우려 존재
  - 가장 비싼 ㄹ애플리케이션 로직이 정적 리소스 때문에 수행 어려울 수 있음
  - WAS 장애 시 오류 화면도 노출 불가능   
  

- 따라서 정적 리소스는 웹 서버가 처리하고 WAS가 중요한 애플리케이션 로직 처리 전담하는 것이 좋음
  - 정적 리소스만 제공하는 웹 서버는 잘 죽지 않음
  - 애플리케이션 로직 동작하는 WAS는 잘 죽음
  - WAS, DB 장애 시 WEB 서버가 오류 화면 제공 가능

    
### 2. 서블릿

#### 1) 서버에서 처리해야 하는 업무 

* 웹 애플리케이션 서버를 직접 구현할 경우 의미있는 비즈니스 로직 전, 후 단계에 구현해야 할 로직이 너무 많음
* 서블릿을 지원하는 WAS 사용 시, 의미있는 비즈니스 로직 제외한 일들을 모두 지원해줌


#### 2) 서블릿

- 개발자가 HTTP 스펙을 매우 편리하게 사용할 수 있게 해줌


- 동작 과정
  - WAS에서 HTTP 요청 메시지를 기반으로 request, response 객체를 새로 생성
  - 서블릿 컨테이너의 서블릿에서 request와 response 객체를 실행
  - 개발자는 request, response 객체에서 HTTP 요청, 응답 정보를 편리하게 사용, 입력
  - WAS는 Response 객체에 담겨있는 내용으로 HTTP 응답 정보를 생성
  - 

#### 3) 서블릿 컨테이너

- WAS에 서블릿 객체의 생성, 호출, 생명주기 관리(WAS 종료 시 서블릿 같이 종료 시켜줌)를 지원하는 서블릿 컨테이너 기능이 존재


- 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 함


- 서블릿 객체는 싱글톤으로 관리됨
  - 최초 로딩 시점에 서블릿 객체 미리 만들어두고 재활용
  - 모든 고객 요청은 동일한 서블릿 객체 인스턴스에 접근
  - 따라서 공유 변수 사용 주의 필요
  - 서블릿 컨테이너 종료 시 함께 종료


- JSP도 서블릿으로 변환되어서 사용


- 동시 요청을 위한 멀티 쓰레드 처리 지원

### 3. 동시 요청 - 멀티 쓰레드

#### 1) 쓰레드
- 서블릿을 호출하는 것은 쓰레드


- 쓰레드는 애플리케이션 코드를 하나하나 순차적으로 실행함


- 쓰레드는 한번에 하나의 코드 라인만 수행 -> 동시 처리가 필요하면 쓰레드 추가 생성 필요

#### 2) 요청마다 쓰레드 생성

- 장점
  - 동시 요청을 처리 가능
  - 리소스(CPU, 메모리)가 허용할 때 까지 처리 가능
  - 하나의 쓰레드가 지연 되어도, 나머지 쓰레드는 정상 동작


- 단점
  - 쓰레드 생성 비용 매우 비쌈
    - 용청 올 때마다 쓰레드 생성 시 응답 속도 느려짐
  - 코어에서 쓰레드 전환할 때, 컨텍스트 스위칭 비용 발생
  - 쓰레드 생성에 제한 없음
    - 요청 너무 많으면 리소스 임계점 넘어서 서버가 죽을 수 있음


#### 3) 쓰레드 풀

- 요청마다 쓰레드 생성의 단점 보완


- 특징
  - 필요한 쓰레드를 쓰레드 풀에 보관 및 관리
  - 쓰레드 풀에 생성 가능한 쓰레드의 최대치를 관리(톰캣은 최대 200개 기본 설정)


- 사용
  - 쓰레드가 필요하면, 이미 생성되어 있는 쓰레드를 쓰레드 풀에서 꺼내 사용
  - 사용 종료 시 쓰레드 풀에 해단 쓰레드를 반납
  - 최대 쓰레드 모두 사용 중이라 쓰레드 풀에 쓰레드 없을 시, 기다리는 요청 거절 or 특정 숫자만큼만 대기하도록 설정 가능
  

- 장점
  - 쓰레드 미리 생성됨 -> 쓰레드 생성과 종료 비용 절약, 응답 시간 빠름
  - 생성 가능한 쓰레드의 최대치 존재 -> 너무 많은 요청 들어와도 기존 요청은 안전하게 처리 가능

##### 실무팁

- WAS의 주요 튜닝 포인트는 최대 쓰레드 수
  - 너무 낮게 설정 -> 동시 요청 많을 때, 서버 리소스는 여유, 클라이언트는 금방 응답 지연
  - 너무 높게 설정 -> 동시 요청 많을 때, 서버 리소스 임계점 초과로 서버 다운


- 적정 숫자는 애플리케이션 로직의 복잡도, CPU, 메모리, IO 리소스 상황에 따라 모두 다름


- 최대한 실제 서비스와 유사하게 성능 테스트 시도


#### 4) WAS의 멀티 쓰레드 지원

- 핵심은 ***멀티 쓰레드에 대한 부분은 WAS가 처리하므로 개발자가 멀티 쓰레드 관련 코드를 신경 쓰지 않아도 된다***는 것


- 개발자는 마치 싱글 쓰레드 프로그래밍 하듯이 편리하게 소스코드를 개발

- 하지만 멀티쓰레드 환경이므로 싱글톤 객체는 주의해서 사용 필요


### HTML, HTTP API, CSR, SSR

